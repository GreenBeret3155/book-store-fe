<div class="row">
  <div class="col-lg-12">
    <nb-card>
      <nb-card-header class="d-flex ">
        <label>Quản lý đơn hàng</label>
        <div class="ml-auto">
          <button nbButton status="danger" size="tiny" (click)="deleteMultiple()"
                  *ngIf="selected && selected.length > 0">
            <nb-icon icon="trash-2-outline" pack="eva"></nb-icon>
            Xóa tất cả
          </button>
        </div>
      </nb-card-header>
      <nb-card-body class="h-100">
        <form [formGroup]="searchForm" class="row">
          <div class="col-lg-3 form-group">
            <label class="label">Trạng thái<span class="text-danger ml-2">*</span></label>
            <ng-select fullWidth appendTo="body"  [items]="lstStatus" bindLabel="text" bindValue="type"
                      [clearable]="false" 
                      formControlName="state">
            </ng-select>
          </div>
          <div class="col-lg-3 form-group ">
            <label class="label">Mã đơn hàng</label>
            <input id="titleChart-input" nbInput fullWidth formControlName="id" trim="blur"
                   (keyup.enter)="page.pageNumber=0;setPage(page)" autofocus>
          </div>
          <div class="form-group col-lg-2 align-items-end d-flex">
            <button nbButton (click)="setPage($event)">Tìm kiếm
              <nb-icon icon="search-outline"></nb-icon>
            </button>
          </div>
        </form>
        <ngx-datatable class="dark"
                       [columnMode]="'flex'"
                       [rows]="orders"
                       [columns]="columns"
                       [externalPaging]="true"
                       [count]="page.totalElements"
                       [offset]="page.pageNumber"
                       [limit]="page.size"
                       [selected]="selected"
                       [selectionType]="'checkbox'"
                       [selectAllRowsOnPage]="false"
                       (select)='onSelect($event)'
                       (page)="setPage($event)"
                       [headerHeight]="50"
                       [rowHeight]="50"
                       [footerHeight]="50"
                       [messages]="{totalMessage:'bản ghi'}"
        >
          <ng-container *ngFor="let col of columns">
            <ngx-datatable-column prop="{{col.prop}}" name="{{col.name}}" [flexGrow]="col.flexGrow">
              <ng-template let-column="column" ngx-datatable-header-template let-allRowsSelected="allRowsSelected"
                           let-selectFn="selectFn">
                <ng-container [ngSwitch]="col.prop">
                  <ng-container *ngSwitchCase="'checkbox'">
                    <input type="checkbox" [checked]="allRowsSelected" (change)="selectFn(!allRowsSelected)"/>
                  </ng-container>
                  <ng-container *ngSwitchDefault>
                    {{ column.name}}
                  </ng-container>
                </ng-container>
              </ng-template>
              <ng-template let-value="value" let-rowIndex="rowIndex" ngx-datatable-cell-template let-row="row"
                           let-isSelected="isSelected"
                           let-onCheckboxChangeFn="onCheckboxChangeFn">
                <ng-container [ngSwitch]="col.prop">
                  <ng-container *ngSwitchCase="'checkbox'">
                    <input type="checkbox" [checked]="isSelected" (change)="onCheckboxChangeFn($event)"/>
                  </ng-container>
                  <ng-container *ngSwitchCase="'stt'">
                    {{rowIndex + 1 + (page.pageNumber * page.size)}}
                  </ng-container>
                  <ng-container *ngSwitchCase="'name'">
                    <span title="{{value}}" class="row-data-show">
                      {{ value && value.length > 60 ? value.substr(0, 60).concat('...') : value}}
                    </span>
                  </ng-container>
                  <ng-container *ngSwitchCase="'state'">
                    {{ getStateString(value) }}
                  </ng-container>
                  <ng-container *ngSwitchCase="'amount'">
                    {{ value | currency: "VND" }}
                  </ng-container>
                  <ng-container *ngSwitchCase="'orderTime'">
                    {{ value | date:'short':'+0700' }}
                  </ng-container>
                  <ng-container *ngSwitchCase="'updateTime'">
                    {{ value | date:'short':'+0700' }}
                  </ng-container>
                  <ng-container *ngSwitchDefault>
                    {{ value }}
                  </ng-container>
                  <ng-container *ngSwitchCase="'action_btn'" class="text-right">
                    <div>
                      <button class="p-1" nbButton status="danger" ghost
                              title="Hủy đơn hàng" (click)="delete(row)">
                        <nb-icon icon="trash-2-outline" pack="eva" size="tiny"></nb-icon>
                      </button>
                      <button class="p-1" nbButton status="success" ghost
                              title="Chuyển tiếp trạng thái" (click)="nextState(row)">
                        <nb-icon icon="arrowhead-right-outline" pack="eva" size="tiny"></nb-icon>
                      </button>
                      <button class="p-1" nbButton status="warning" ghost
                              title="Xem chi tiết" (click)="edit(row)">
                        <nb-icon icon="eye-outline" pack="eva" size="tiny"></nb-icon>
                      </button>
                      
                      <!-- <button class="p-1" nbButton status="primary" ghost
                              title="{{'configChart.label.clone'}}" (click)="clone(row)">
                        <nb-icon icon="copy-outline" pack="eva" size="tiny"></nb-icon>
                      </button> -->
                    </div>
                  </ng-container>

                </ng-container>
              </ng-template>
            </ngx-datatable-column>
          </ng-container>
        </ngx-datatable>

      </nb-card-body>
    </nb-card>
  </div>
</div>

